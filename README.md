# log-system

##  简述

该项目一共实现了3种落地方式：屏幕、指定文件、滚动文件（按照文件大小，按照时间），并且采用同步、异步两种方式进行落地，在异步方式中，用了两个缓冲区，一个生产者缓冲区（向缓冲区写入日志），一个消费者缓冲区（向缓冲区读取数据），一旦生产者缓冲区有数据了就进行交换，让消费者取出数据，直到日志输出完毕并且缓冲区没有数据。

## 模块

**工具模块：** 提供了获取当前时间、判断文件是否存在、获取文件路径、创建文件夹接口。

**日志等级模块：** 对日志进行划分，方便控制输出。

**日志消息模块：** 每条日志要用到的要素：时间、线程id、日志等级、日志数据、日志文件名、日志行号、日志器名称。

**日志格式化模块：** 设置日志输出格式

- 日志默认输出格式为：`[%d{%H:%M:%S}][%t][%c][%f:%l][%p]%T%m%n` 
- 其中``[%d{%H:%M:%S}]` ：日期，花括号内表示日期格式
- `%t` ：线程id。
- `%c` ：日志器名称。
- `%f` ：文件名。
- `%l` ：行号。
- `%p` ：消息等级。
- `%T` ：制表符`\t` 。
- `%m` ：消息有效载荷。
- `%n` ：换行符`\n`。

利用面向对象的多态性，设计一个格式化基类，再设计多个子类，使得每个子类从日志消息中取出不同的数据。

**日志消息落地模块：** 日志的实际落地方式：

1. 标准输出：将日志输出到屏幕。
2. 指定文件：将日志输出到指定文件中。
3. 滚动文件：超过一定大小，就输出到另一个文件。

**日志器模块：** 将上面所有模块整合起来，通过日志器实现日志的输出。

## 性能测试

测试每秒能输出多少条日志。

**测试方法：** 每秒输出日志条数 = 总日志条数 / 总用时。

**测试要素：** 同步/异步以及单线程/多线程。

**测试数据量：** 1000000条日志，每条日志100字节，总大小:97656KB。

**测试环境：** 

- OS：Ubuntu-22.04LTS
- CPU：11th Gen Intel(R) Core(TM) i5-1135G7 @ 2.40GHz
- RAM：16G
- ROM：512G-SSD

**测试结果：** 

* **同步：** 

  - **单线程：** 
    * 线程0   输出日志数量:1000000,耗时时长:1.12163s
    * 总耗时:1.12163s
    * 每秒输出数量:891558条
    * 每秒输出大小:87066KB

  - **多线程：** 
    * 线程0   输出日志数量:333333,耗时时长:1.92977s
    * 线程2   输出日志数量:333333,耗时时长:1.9415s
    * 线程1   输出日志数量:333333,耗时时长:1.94321s
    * 总耗时:1.94321s
    * 每秒输出数量:514611条
    * 每秒输出大小:50254.9KB

* **异步：** 

  - **单线程：** 
    * 线程0   输出日志数量:1000000,耗时时长:1.19029s
    * 总耗时:1.19029s
    * 每秒输出数量:840130条
    * 每秒输出大小:82043.7KB
  - **多线程：** 
    * 线程2   输出日志数量:333333,耗时时长:1.03612s
    * 线程1   输出日志数量:333333,耗时时长:1.19038s
    * 线程0   输出日志数量:333333,耗时时长:1.2004s
    * 总耗时:1.2004s
    * 每秒输出数量:833058条
    * 每秒输出大小:81353.1KB

